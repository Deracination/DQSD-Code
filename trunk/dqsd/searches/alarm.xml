<search function="alarm">
  <name>Alarm</name>
  <description>
    Schedule an alarm to go off at a certain time. The alarm message is optional. (All times are in Military (24hr) Time. Supports only a single alarm.)<br/>
    <a class="helpboxDescLabels">Usage:</a><br/>
  	<table class="helpBoxDescTable">
  		<tr><td class="helpboxDescColumns">Set alarm.</td><td class="helpboxDescColumns"> - </td><td class="helpboxDescColumns">alarm &lt;time&gt; [&lt;message&gt;]</td></tr>
  		<tr><td class="helpboxDescColumns">Cancel alarm.</td><td class="helpboxDescColumns"> - </td><td class="helpboxDescColumns">alarm cancel</td></tr>
  	</table>
    <a class="helpboxDescLabels">Example:</a><br/>
    <table class="helpBoxDescTable">
  		<tr><td class="helpboxDescColumns">alarm 14:00 Staff Meeting</td></tr>
  	</table>
  </description>
  <category>Functions</category>
  <contributor>Monty Scroggins</contributor>
  
  <script><![CDATA[
    var alarmTime;
    var curTime;
    var alarmMsg;
    var alNum;
    var parsedLine;
    var parsedMsg;
     
    function alarm(t) 
    {
      if( t.match(/^cancel *$/i) ) 
      {
        clearInterval(alNum);
        document.deff.q.value="Alarm Canceled..";
        setTimeout("document.deff.q.value='';",1000);
      }
      else if( parsedLine = t.match(/(\d\d\:\d\d)\s*(.*)/) ) 
      {
        if( parsedLine[1] != null && parsedLine[1].length != 0) 
          alarmTime = parsedLine[1];
          
        parsedMsg = parsedLine[2];
        alarmMsg =  'Alarm: ' + alarmTime + '\n\nAlarm has Expired';
          
        if(parsedMsg != null && parsedMsg.length != 0 )
          alarmMsg = 'Alarm: ' + alarmTime + '\n\n' + parsedMsg;
          
        alarmOn();
        document.deff.q.value="Alarm Set..";
        setTimeout("document.deff.q.value='';",1000);
      }
      else 
      {
        window.alert("Bad Timestamp Entered. Should be HH:MM in Military Time");
        return;
      }
    }

    function IfZero( num ) 
    {
      return (num <= 9) ? ("0" + num) : num;
    }

    function alarmOn() 
    {
      var dt = new Date();
      curTime = IfZero(dt.getHours()) + ":" + IfZero(dt.getMinutes());
      if( alarmTime == curTime )
      {
        clearInterval(alNum);
        window.alert(alarmMsg);
      }
      else
        alNum=setTimeout("alarmOn()", 6000)
    }
  ]]></script>
</search>
